
1. Diff 策略

React在比较新旧2棵虚拟DOM树的时候,会同时考虑:
- 尽量少的创建/删除节点,多使用移动节点的方式
- 比较次数要尽量少,算法要足够的快

**如果只考虑第一点,算法的时间复杂度要达到O(n^3)的级别.也就是说对于一个有1000个节点的树,要进行10亿次的比较.** 因此,React选用了启发式的算法.这个算法基于以下2个假设:
- 如果2个节点的类型不一样,以这2个节点为根节点的树会完全不同
- 对于多次render中结构保持不变的节点,开发者会用一个key属性标识出来,以便重用.

另外,React只会对同一层的节点作比较,不会跨层级比较.

Diff使用的是深度优先算法((deep -first search, DFS)是一种遍历或搜索树或图数据结构的算法。一个从根节点开始(在图中选择任意节点作为根节点)，并在回溯之前尽可能沿着每个分支进行研究。)

![image](https://segmentfault.com/img/bVbjz1q?w=542&h=221)

当D节点改为G节点时,整棵D子树会被删除,E、F节点会重新创建。

对于列表的Diff，节点的key有助于节点的重用：
![image](https://segmentfault.com/img/bVbjz9Q?w=1366&h=365)

当没有key的时候，如果中间插入一个新节点，Diff过程中从第三个节点开始的节点都是删除旧节点，创建新节点。当有key的时候，除了第三个节点是新创建外，第四和第五个节点都是通过移动实现的。